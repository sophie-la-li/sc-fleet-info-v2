#!/bin/bash

SCRIPT_DIR=$(realpath $(dirname "${BASH_SOURCE[0]}"))

SRC_DIR=$SCRIPT_DIR/../src
SRC_HTML_FILE=$SRC_DIR/sc-fleet-info.html
SRC_CSS_FILE=$SRC_DIR/sc-fleet-info.css
SRC_SCRIPT_FILE=$SRC_DIR/sc-fleet-info.js

DEST_DIR=$SCRIPT_DIR/../injector-script
DEST_FILE=$DEST_DIR/sc-fleet-info.js
DEST_TPL_FILE=$DEST_DIR/sc-fleet-info.js.tpl

SRC_HTML=$(cat $SRC_HTML_FILE)
SRC_CSS=$(cat $SRC_CSS_FILE)
SRC_SCRIPT=$(cat $SRC_SCRIPT_FILE)

SCRIPT_IGNORE_START_KEYWORD="//siis"
SCRIPT_IGNORE_START_REPLACEMENT="/*"
SCRIPT_IGNORE_END_KEYWORD="//siie"
SCRIPT_IGNORE_END_REPLACEMENT="*/"

HTML_IGNORE_START_KEYWORD="<!--siis-->"
HTML_IGNORE_START_REPLACEMENT="<!--"
HTML_IGNORE_END_KEYWORD="<!--siie-->"
HTML_IGNORE_END_REPLACEMENT="-->"

if [ -f $DEST_FILE ]; then
    rm $DEST_FILE
fi

cp $DEST_TPL_FILE $DEST_FILE

sed -e '/##CSS##/ {' -e "r $SRC_CSS_FILE" -e 'd' -e '}' -i $DEST_FILE
sed -e '/##HTML##/ {' -e "r $SRC_HTML_FILE" -e 'd' -e '}' -i $DEST_FILE
sed -e '/##SCRIPT##/ {' -e "r $SRC_SCRIPT_FILE" -e 'd' -e '}' -i $DEST_FILE

sed -i "s,$SCRIPT_IGNORE_START_KEYWORD,$SCRIPT_IGNORE_START_REPLACEMENT,g" $DEST_FILE
sed -i "s,$SCRIPT_IGNORE_END_KEYWORD,$SCRIPT_IGNORE_END_REPLACEMENT,g" $DEST_FILE

sed -i "s,$HTML_IGNORE_START_KEYWORD,$HTML_IGNORE_START_REPLACEMENT,g" $DEST_FILE
sed -i "s,$HTML_IGNORE_END_KEYWORD,$HTML_IGNORE_END_REPLACEMENT,g" $DEST_FILE

